# サンプル管理システム 管理者向け手順書

## サイト情報

| 項目 | 値 |
|------|-----|
| **公開URL** | https://your-project-id.web.app |
| **Firebaseコンソール** | https://console.firebase.google.com/project/your-project-id |
| **プロジェクトID** | your-project-id |

---

## 1. サイトの公開（初回のみ）

### Firebase CLIのインストール
```bash
sudo npm install -g firebase-tools
```

### ログイン
```bash
firebase login
```
→ ブラウザが開くのでGoogleアカウントでログイン

### デプロイ（公開）
```bash
cd /path/to/sample-manager
firebase deploy --only hosting
```

成功すると以下のように表示されます：
```
✔ Deploy complete!

Hosting URL: https://your-project-id.web.app
```

---

## 2. ユーザー管理

### 新しいユーザーを追加する
1. サイトにログイン
2. 「設定」タブを開く
3. メールアドレスを入力して「追加」をクリック

**または** Firebaseコンソールから：
1. Firebaseコンソール → Firestore Database
2. `allowedUsers` コレクションを開く
3. 「ドキュメントを追加」でメールアドレスを追加

### ユーザーを削除する
1. 「設定」タブでユーザー一覧から「削除」をクリック

---

## 3. データ管理

### バックアップ
1. 「設定」タブの「Excelでバックアップ」または「JSONでバックアップ」をクリック
2. ファイルがダウンロードされます

### Firebaseコンソールからのデータ確認
Firebaseコンソール → Firestore Database で以下のコレクションがあります：
- `samples` - サンプルデータ
- `usageHistory` - 使用履歴
- `allowedUsers` - 許可ユーザー
- `settings` - 閾値設定など

---

## 4. アプリの更新

コードを修正した場合：
```bash
cd /path/to/sample-manager
firebase deploy --only hosting
```

---

## 5. ローカルでのテスト

公開前にローカルでテストする場合：
```bash
cd /path/to/sample-manager
python3 -m http.server 8080
```
→ http://localhost:8080 でアクセス

---

## 6. トラブルシューティング

### デプロイが失敗する
```bash
firebase login --reauth
```
で再認証してから再度デプロイ

### データが表示されない
Firestoreのセキュリティルールを確認：
```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

### 画像がアップロードできない
Storageのセキュリティルールを確認：
```
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

---

## 7. 費用について

Firebase無料枠（Sparkプラン）の範囲：
- Firestore: 1GB保存、50,000読み取り/日
- Storage: 5GB保存
- Hosting: 10GB転送/月

小〜中規模の研究室利用なら無料枠で十分です。

---

## ファイル構成

```
sample-manager/
├── index.html          # アプリ本体
├── firebase.json       # Firebase設定
├── .firebaserc         # プロジェクト設定
├── README.md           # セットアップ手順
├── 利用者向け手順書.md  # 一般ユーザー向け
└── 管理者向け手順書.md  # 本ファイル
```
